{% extends "base.html" %}

{% block title %}Create New Card - brett{% endblock %}

{% block header %}<h1>Create New Card</h1>{% endblock %}

{% block content %}
<div class="confirm-container">
    <h2>Create New Card with Email</h2>

    {% if error %}
    <div class="message message-danger">
        {{ error }}
    </div>
    {% endif %}

    <div class="email-info">
        <h3>Email Details</h3>
        <div class="email-field">
            <strong>From:</strong> {{ parsed.from_addr }}
        </div>
        <div class="email-field">
            <strong>Subject:</strong> {{ parsed.subject }}
        </div>
        <div class="email-field">
            <strong>Card title:</strong> {{ card_title }}
        </div>
        <div class="email-field">
            <strong>Date:</strong> {{ parsed.date|date:"Y-m-d H:i" }}
        </div>
        <div class="email-field">
            <strong>Body Preview:</strong>
            <div class="body-preview">{{ parsed.body|linebreaksbr|truncatewords_html:150 }}</div>
        </div>
    </div>

    <div class="info-message">
        <p>A new card will be created with the above title, and this email will be added as the first entry.</p>
    </div>

    <form method="post" class="confirm-form">
        {% csrf_token %}
        <div class="form-group">
            <label for="summary">Summary (optional)</label>
            <input
                type="text"
                id="summary"
                name="summary"
                class="form-input"
                placeholder="e.g., '+1', 'questions', 'approved'"
                maxlength="200"
            >
            <small style="color: #666;">Very short summary of this entry (optional)</small>
        </div>
        <div class="form-group">
            <label for="column">Column</label>
            <select id="column" name="column_id" class="form-input">
                {% for column in columns %}
                <option value="{{ column.id }}" {% if column.id == last_used_column_id %}selected{% endif %}>{{ column.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Create Card and Import</button>
            <a href="{% url 'suggest_cards' %}" class="btn btn-secondary">‚Üê Back</a>
        </div>
    </form>
</div>
{% endblock %}
